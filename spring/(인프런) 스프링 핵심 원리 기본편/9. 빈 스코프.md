
# 빈 스코프
- 스코프: 빈이 존재할 수 있는 범위
	- `싱글톤`: 기본 스코프, 스프링 컨테이너의 시작과 종료까지 유지됨, 가장 넓은 범위의 스코프
	- `프로토타입`: 스프링 컨테이너가 빈의 생성과 의존 관계 주입까지만 관여함
	- 웹 관련 스코프
		- request: 웹 요청이 들어오고 나갈 때까지 유지됨
		- session: 웹 세션이 생성되고 종료될 때까지 유지됨
		- application: 웹의 서블릿 컨텍스트와 같은 범위로 유지됨

# 프로토타입 스코프
- 프로토타입 스코프를 스프링 컨테이너에 조회하면 항상 새로운 인스턴스를 생성해서 반환함
- 스프링 컨테이너는 프로토타입 빈의 생성, 의존 관계 주입, 초기화까지만 처리함
- 프토로타입 빈을 관리할 책임을 프로토타입 빈을 받은 클라이언트에 있음
- 스프링 컨테이너가 종료될 때 @PreDestroy와 같은 종료 메서드가 자동으로 호출되지 않음
- 종료 메서드 호출 또한 클라이언트가 해야 됨

# 싱글톤 빈과 프로토타입 빈을 함께 사용할 때 문제점
- 싱글톤 빈 클래스의 필드에 프로토타입 빈이 있음\
- 싱글톤 빈의 생성 시점에 의존 관계 주입을 통해 프로토타입 빈이 생성됨
- 프토토타입 빈이 사용할 때마다 생성되지 않고 싱글톤 빈과 함께 계속 유지됨

# 해결방법
- [스프링 컨테이너에 요청](#스프링-컨테이너에-요청)
- [ObjectProvider 사용 (springframework)](#ObjectProvider-사용)
- [JSR-330 Provider 사용 (JSR-330 자바 표준)](#JSR-330-Provider-사용)

# 스프링 컨테이너에 요청
- 싱글톤 빈에 스프링 컨테이너 전체를 의존 관계 주입
- 프로토타입 빈이 필요할 때마다 스프링 컨테이너에 새로 요청
	- 필요한 의존 관계를 찾는 것을 Dependency Lookup(DL), 의존 관계 조회(탐색)라고 함
- 스프링의 애플리케이션 컨텍스트 전체를 주입받게 되면, 스프링 컨테이너에 종속적인 코드가 되고 단위 테스트가 어려워짐
- 지정한 프로토타입 빈을 컨테이너에서 대신 찾아주는, DL 기능만 제공하는 방식 필요

# ObjectProvider 사용
- DL 기능 제공
- ObjectProvider의 getObject()를 호출하면 스프링 컨테이너에서 해당하는 빈을 찾아 반환
- ObjectFactory: 기능 단순, 별도 라이브러리 필요 없음, 스프링에 의존
- ObjectProvider: ObjectFactory 상속, 다양한 편의 기능, 별도 라이브러리 필요 없음, 스프링에 의존

# JSR-330 Provider 사용
- JSR-330 자바 표준 사용
- DL 기능 제공
- Provider의 get()을 호출하면 스프링 컨테이너에서 해당하는 빈을 찾아 반환
- get() 메서드 하나만 가지고 있음
- 별도의 라이브러리 필요
- 자바 표준이므로 스프링이 아닌 다른 컨테이너에서도 사용 가능

# 웹 스코프
- 웹 환경에서 동작
- 스프링이 해당 스코프의 종료시점까지 관리함
- 종류
	- request: HTTP 요청 하나가 들어오고 나갈 때까지 유지되는 스코프
	- session: HTTP Session과 동일한 생명주기를 가지는 스코프
	- application: 서블릿 컨텍스트와 동일한 생명주기를 가지는 스코프
	- websocket: 웹 소켓과 동일한 생명주기를 가지는 스코프

# request 스코프
- request 스코프 빈에 HTTP 요청에 대한 UUID, 요청 URL 등을 저장함
	- UUID: Universally Unique Identifier, 범용 고유 식별자, 소프트웨어 구축에 쓰이는 식별자 표준
- request 스코프 빈을 통해 웹과 관련된 정보가 웹과 관련없는 서비스 계층까지 파라미터를 통해 넘어가는 것을 막을 수 있으므로 코드와 계층을 깔끔하게 유지할 수 있음

# request 스코프 사용
- request 스코프 빈은 스프링 애플리케이션을 실행하는 시점에 생성되지 않음
- HTTP 요청(클라이언트의 요청)이 와야 생성됨
- 싱글톤 빈과 달리 스프링 애플리케이션을 실행하는 시점에 생성, 의존 관계 주입을 할 수 없음
- 그냥 스프링 애플리케이션을 실행하면 오류가 발생함
- 오류 해결 방법
	- Provider 또는 ObjectProvider를 통해 빈의 생성을 지연할 수 있음\
	- [@Scope의 proxyMode](#@Scope의-proxyMode) 설정을 이용

# @Scope의 proxyMode
- 적용 대상이 클래스면 proxyMode = ScopedProxyMode.TARGET_CLASS
- 적용 대상이 인터페이스면 proxyMode = ScopedProxyMode.INTERFACES
- CGLIB 라이브러리로 request 스코프 클래스를 상속받은 프록시 클래스의 객체를 만들어 의존 관계 주입
- 프록시 객체를 통해 request 스코프 객체의 기능을 그대로 사용
- request 스코프 빈을 싱글톤 빈처럼 편리하게 사용 가능
