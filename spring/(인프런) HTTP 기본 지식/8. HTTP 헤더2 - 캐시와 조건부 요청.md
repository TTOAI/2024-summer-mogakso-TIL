
# 캐시와 캐시 관련 헤더
- 웹 브라우저의 브라우저 캐시에 이전 응답 결과를 저장
- 캐시가 유효할 때까지 네트워크 사용량을 줄일 수 있음
- 캐시 관련 헤더
	- [Cache-control](#Cache-Control)
	- [Pragma](#Pragma)
	- [Expires](#Expires)
	- [검증 헤더](#검증-헤더)와 [조건부 요청 헤더](#조건부-요청-헤더)

# Cache-Control
- 캐시 지시어(directives): 브라우저와 공유 캐시의 캐싱 제어
	- Cache-Control: max-age
		- 캐시 유효 시간, 초 단위
	- Cache-Control: no-cache
		- 데이터는 캐시해도 되지만, 항상 origin 서버에 검증하고 사용
	- Cache-Control: no-store
		- 데이터에 민감한 정보가 있으므로 저장하면 안 됨

# Pragma
- Pragma: no-cache
	- Cache-Control: no-cache 와 같은 기능
	- Cache-Control 헤더가 없는 HTTP 1.0에서 쓰임

# Expires
- 날짜와 시간을 포함한 캐시 만료일 지정
- 요청에 max-age 또는 s-maxage를 가진 Cache-Control이 있으면 무시됨

# 검증 헤더
- 응답 헤더
- 캐시 데이터와 서버 데이터가 같은지 검증하는 데이터를 가짐
-  Last-Modified
	- 리소스가 수정된 최근 날짜와 시간을 포함함
	- ETag보다 부정확함
	- If-Modified-Since 또는 If-Unmodified-Since 헤더를 가진 조건부 요청이 이 헤더의 정보를 사용함
- ETag (entity tag)
	- 리소스의 특정 버전에 대한 식별자를 가짐
	- 리소스의 내용이 변하지 않았으면 서버는 리소스를 다시 보낼 필요가 없음

# 조건부 요청 헤더
- 요청을 조건부 요청으로 바꾸는 헤더
- Last-Modified와 함께 쓰이는 헤더
	- If-Modified-Since
		- 오직 GET 또는 HEAD와 쓰임
		- 헤더에 지정된 날짜와 리소스의 최근 수정 날짜가 다르면 서버는 200 상태 코드와 함께 요청된 리소스를 보냄
		- 헤더에 지정된 날짜 이후로 리소스가 수정되지 않았으면 서버는 304 상태 코드와 함께 body가 없는 응답을 보냄
	- If-Unmodified-Since
		- 헤더에 지정된 날짜 이후에 리소스가 수정되지 않은 경우에만 요청된 리소스를 보내거나 POST 또는 기타 non-safe 메서드에 대한 요청을 승인함
		- 리소스가 지정된 날짜 이후에 수정된 경우 서버는 응답으로 412 Precondition Failed 오류를 보냄
- ETag와 함께 쓰이는 헤더
	- If-None-Match
		- Get 또는 HEAD 메서드의 경우,
			- 서버는 자신이 가진 ETag가 If-None-Match 헤더에 지정된 ETag들 중에 없으면 요청된 리소스를 반환함
			- 조건이 실패하면 서버는 304 Not Modified를 반환함, 또한 동일한 요청에 대해 200 OK 응답으로 전송되는 다양한 헤더 필드(Cache-Control, Content-Location, Date, ETag, Expires 등) 중 하나를 생성해야 함
		- 다른 메서드의 경우,
			- 최종적으로 존재하는 리소스의 ETag가 If-None-Match 헤더에 지정된 ETag들 중에 없으면 요청이 처리됨
			- 조건이 실패하면 412 Precondition Failed 오류를 보냄
		- If-Modified-Since와 함께 사용할 경우 If-None-Match가 우선 적용됨

# 프록시 캐시
- 서버와 클라이언트 사이에 위치하여 리소스를 저장하고 관리
- 동일한 리소스에 대한 요청이 반복될 때 서버로부터 다시 다운로드할 필요 없이 빠르게 제공
- 클라이언트가 리소스를 요청하면 프록시 캐시 서버의 캐시를 먼저 확인함
- 프록시 캐시와 관련된 Cache-Control 헤더의 지시어(directives)
	- Cache-Control: public
		- 응답이 public 캐시에 저장되어도 됨
	- Cache-Control: private
		- 응답이 해당 사용자만을 위한 것임, private 캐시에 저장해야 함(기본값)
	- Cache-Control: s-maxage
		- 프록시 캐시에만 적용되는 max-age
- 프록시 캐시와 관련된 HTTP 헤더
	- Age: 60
		- origin 서버에서 응답 후 프록시 캐시 내에 머문 시간(초)

# 캐시 무효화
- 캐시를 확실하게 무효화하기 위한 응답
	- Cache-Control: no-cache, no-store, must-revalidate
	- Pragma: no-cache (HTTP 1.0을 위한 헤더)
- Cache-Control: must-revalidate
	- 캐시 유효 시간이라면 캐시를 사용함
	- 캐시 만료 후 최초 조회 시 origin 서버에 검증해야 함
	- origin 서버 접근 실패 시 반드시 오류가 발생해야 함 (504 Gateway Timeout)
- no-cache와 must-revalidate
	- no-cache는 origin 서버에 접근할 수 없는 경우 캐시 서버 설정에 따라 캐시 데이터를 반환할 수 있음
	- must-revalidate는 origin 서버에 접근할 수 없는 경우 항상 오류가 발생해야 함
